<!DOCTYPE html>
<head>
    <meta name = "description" content = "GDP per capita from 1815 to 2010">
    <meta charset = "utf-8">
    <title>Economic Growth</title>
    <style type = "text/css">
        body {font: Garamond; width: 100%; text-align: center; background-color: #fffff8}
        div.chart {margin: 0px auto; width: 1200px; text-align: center;}
        .axis path, .axis line {fill: none; stroke: gray; stroke-width: 1; shape-rendering: crispEdges;}
        .y.axis {font-family: monospace; font-size: 10px; fill: dimgray;}
        .y.axis path.domain {stroke: lightgray;}
        .x.axis path {stroke: lightgray;}
        .y.axis line {stroke: #fff; stroke-opacity: 1; shape-rendering: crispEdges; stroke-width: 1;}
    </style>
</head>
<body>
    <div class = "chart">
    <h3>GDP per Capita* from 1815 to 2010</h3>
    </div>
    <script src = "https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script type = "text/javascript">
        
        var margin = {top: 20, bottom: 30, left: 35, right: 20},
            width = 200 - margin.left - margin.right,
            height = 210 - margin.top - margin.bottom;
        
        var bisectDate = d3.bisector(function(d){return d.Year}).left;
        
        var x = d3.scale.linear().range([0, width]).domain([1815, 2010]),
            y = d3.scale.linear().range([height, 0]);
        
        var xAxis = d3.svg.axis().scale(x).orient("bottom").ticks(0),
            yAxis = d3.svg.axis().scale(y).orient("left").tickSize(1).tickFormat(function(d){return Math.round(d/1000) + "K";}).ticks(5);
        
        var valueline = d3.svg.line().x(function(d){return x(d.Year)}).y(function(d){return y(d.GDP)}).interpolate("linear"),
            area = d3.svg.area().x(function(d){return x(d.Year)}).y0(height).y1(function(d){return y(d.GDP)});
        
        d3.csv("http://lxii.github.io/growth/gdp.csv", function(error, data) {
            data.forEach(function(d){
                d.Year = +d.Year;
                d.GDP = +d.GDP;
            });

          var countries = d3.nest()
              .key(function(d) { return d.Country; })
              .entries(data);
            
            countries.sort(function(a, b){
              return d3.descending(b.key, a.key);
              });

          var svg = d3.select("div").selectAll("svg")
              .data(countries)
            .enter().append("svg")
              .attr("width", width + margin.left + margin.right)
              .attr("height", height + margin.top + margin.bottom)
            .append("g")
              .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
              .attr("id", function(d){return d.key;});

          var lines = svg.append("path")
              .attr("class", "line")
              .attr("fill", "none")
              .attr("stroke-width", 1)
              .attr("stroke", "black")
              .attr("opacity", 0.4)
              .attr("d", function(d) { y.domain([0, 32000]); return valueline(d.values); });
            
            svg.
            append("path")
            .attr("d", function(d){ y.domain([0, 32000]); return area(d.values); })
            .attr("class", "area")
            .attr("fill", "steelblue")
            .attr("opacity", 0.07);

            d3.select("#Australia").append("g")
            .attr("class", "y axis")
            .call(yAxis);
            
            d3.select("#Australia").append("text")
            .text("Year")
            .attr("y", height + 25)
            .attr("x", width/2 - 15)
            .attr("font-family", "sans-serif")
            .attr("font-size", "12px")
            .attr("fill", "gray");
            
            d3.select("#Australia").append("text")
            .text("GDP Per Capita, $1000")
            .attr("y", -25)
            .attr("x", -15)
            .attr("text-anchor", "end")
            .attr("transform", "rotate(-90)")
            .attr("font-family", "sans-serif")
            .attr("font-size", "12px")
            .attr("fill", "gray");
            
            d3.select("#Finland").append("g")
            .attr("class", "y axis")
            .call(yAxis);
            
            d3.select("#Norway").append("g")
            .attr("class", "y axis")
            .call(yAxis);
            
            svg.append("g")
            .attr("class", "x axis")
            .attr("transform", "translate(0," + height + ")")
            .call(xAxis);
               
          svg.append("text")
              .attr("x", width/2)
              .attr("y", -5)
              .attr("font-size", 13)
              .attr("fill", "black")
              .attr("font-family", "monospace")
              .style("text-anchor", "middle")
              .text(function(d) { return d.key; });
            
            var focus = svg.append("g").style("display", "none");
            focus.append("circle")
            .attr("class", "y")
            .style("fill", "none")
            .style("stroke", "blue")
            .attr("r", 3);
            
            svg.append("rect")
            .attr("width", width)
            .attr("height", height)
            .style("fill", "none")
            .style("pointer-events", "all")
            .on("mouseover", function(){focus.style("display", null);})
            .on("mouseout", function(){focus.style("display", "none");})
            .on("mousemove", mousemove);
            
            focus.append("text")
            .attr("class", "value")
              .attr("dy", "-1em")
              .attr("dx", "-3em");
            
            focus.append("text")
            .attr("class", "year")
              .attr("dy", "-0.6em")
              .attr("dx", "-2em");
            
            function mousemove(){
                var xpos = d3.mouse(this)[0],
                    date = x.invert(xpos),
                    i = 0;
                
              focus.select("circle.y")
              .attr("cx", x(date))
              .attr("cy", function(d){
                  index = bisectDate(d.values, Math.floor(date), 0, d.values.length - 1);
                  return y(d.values[index].GDP);
              });
                focus.select("text.value")
                .attr("transform", function(d){ return "translate(" + x(date) + "," + y(d.values[index].GDP) + ")";})
                .attr("font-size", 12)
                .attr("font-family", "monospace")
                .attr("x", 9)
                .attr("fill", "black")
                .text(function(d) { if(d.values[index].GDP != 0){return "$ " + (d.values[index].GDP/1000).toFixed(1)+"K";}else{return ""};})
            
               
                focus.select("text.year")
                .attr("transform", function(d){ return "translate(" + x(date) + "," + (margin.bottom-9 + height) + ")";})
                .attr("font-size", 12)
                .attr("font-family", "monospace")
                .attr("x", 9)
                .attr("fill", "black")
                .text(Math.floor(date));
        
                };
            
        d3.select("div.chart")
        .append("div")
        .html("Source: The Maddison-Project, "+ "<a href = 'https://www.ggdc.net/maddison/maddison-project/home.htm'>2013 version</a>.<br>*GDP per capita is measured in 1990 <a href= 'https://en.wikipedia.org/wiki/Geary%E2%80%93Khamis_dollar'>international Geary-Khamis dollars</a>.");
        });
    </script>
</body>
